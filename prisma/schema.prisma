generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url       = env("DATABASE_URL")
}

model User {
  id             Int            @id @default(autoincrement())
  phone          String         @unique
  name           String?
  opt_in         Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  conversations  Conversation[]
}

model Conversation {
  id             Int        @id @default(autoincrement())
  userId         Int
  user           User       @relation(fields: [userId], references: [id])
  messages       Message[]
  lastAt         DateTime   @default(now())
  ttlExpire      DateTime?
}

model Message {
  id               Int          @id @default(autoincrement())
  conversationId   Int
  // Linha corrigida para estabelecer o relacionamento reverso (lado "um")
  conversation     Conversation @relation(fields: [conversationId], references: [id]) 
  role             String
  content          String       @db.Text
  createdAt        DateTime     @default(now())
}

model Product {
  id             Int        @id @default(autoincrement())
  sku            String?    @unique
  title          String
  description    String?    @db.Text
  priceCents     Int?
  available      Boolean    @default(true)
  sourceUrl      String?
  updatedAt      DateTime   @updatedAt
}

model ProductCache {
  id             Int        @id @default(autoincrement())
  key            String     @unique
  data           String     @db.Text
  ttl            DateTime
}

model Setting {
  id             Int    @id @default(autoincrement())
  key            String @unique
  value          String
}
